{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/* pages/index.js */\nimport React, { Component, Fragment } from 'react';\nimport axios from 'axios';\nimport Pusher from 'pusher-js';\nimport Layout from '../components/Layout';\nimport ChoosePersona from '../components/ChoosePersona';\nimport NearbyFriends from '../components/NearbyFriends';\nimport Map from '../components/Map';\n\nclass IndexPage extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"regionFiltered\", people => this.nearby.updatePeople(people));\n\n    _defineProperty(this, \"state\", {\n      id: null,\n      people: [],\n      me: null\n    });\n\n    _defineProperty(this, \"endConnection\", () => {\n      this.pusher.disconnect();\n      axios.post(`/offline/${this.state.id}`);\n    });\n\n    _defineProperty(this, \"personaSelected\", id => {\n      this.setState({\n        id\n      });\n      axios.post(`/online/${id}`);\n    });\n  }\n\n  componentWillMount() {\n    this.pusher = new Pusher(process.env.PUSHER_APP_KEY, {\n      cluster: process.env.PUSHER_APP_CLUSTER,\n      encrypted: true\n    });\n    this.channel = this.pusher.subscribe('map-geofencing');\n  }\n\n  componentDidMount() {\n    //get my current location\n    if ('geolocation' in navigator) {\n      navigator.geolocation.getCurrentPosition(function (position) {\n        const myLocation = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n        this.state.me = myLocation;\n        console.log(myLocation);\n      });\n    }\n\n    axios.get('/people').then(({\n      data\n    }) => {\n      const {\n        people = []\n      } = data;\n      this.setState({\n        people\n      });\n    });\n    window.onbeforeunload = this.endConnection;\n  }\n\n  componentWillUnmount() {\n    this.endConnection();\n  }\n\n  render() {\n    const {\n      id,\n      people\n    } = this.state;\n    const person = people.find(person => person.id === id) || {}; // const peopleOffline = people.filter(person => !person.online);\n\n    return __jsx(Layout, {\n      pageTitle: \"Realtime Geofencing\"\n    }, __jsx(\"main\", {\n      className: \"container-fluid position-absolute h-100 bg-light\"\n    }, id ? __jsx(\"div\", {\n      className: \"row position-absolute w-100 h-100\"\n    }, __jsx(\"section\", {\n      className: \"col-md-9 px-0 border-right border-gray position-relative h-100\"\n    }, __jsx(Map, {\n      person: person,\n      radius: 1000,\n      people: people,\n      channel: this.channel,\n      onRegionFiltered: this.regionFiltered,\n      me: this.state.me\n    })), __jsx(\"section\", {\n      className: \"col-md-3 position-relative d-flex flex-wrap h-100 align-items-start align-content-between bg-white px-0\"\n    }, __jsx(NearbyFriends, {\n      ref: elem => this.nearby = elem,\n      person: person\n    }))) : __jsx(ChoosePersona, {\n      count: 5,\n      people: people,\n      onSelected: this.personaSelected\n    })));\n  }\n\n}\n\n;\nexport default (() => __jsx(IndexPage, null));","map":{"version":3,"sources":["/home/ubuntu/environment/cikoo-geof/pages/index.js"],"names":["React","Component","Fragment","axios","Pusher","Layout","ChoosePersona","NearbyFriends","Map","IndexPage","people","nearby","updatePeople","id","me","pusher","disconnect","post","state","setState","componentWillMount","process","env","PUSHER_APP_KEY","cluster","PUSHER_APP_CLUSTER","encrypted","channel","subscribe","componentDidMount","navigator","geolocation","getCurrentPosition","position","myLocation","lat","coords","latitude","lng","longitude","console","log","get","then","data","window","onbeforeunload","endConnection","componentWillUnmount","render","person","find","regionFiltered","elem","personaSelected"],"mappings":"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","sourcesContent":["/* pages/index.js */\n\n    import React, { Component, Fragment } from 'react';\n    import axios from 'axios';\n    import Pusher from 'pusher-js';\n    import Layout from '../components/Layout';\n    import ChoosePersona from '../components/ChoosePersona'\n    import NearbyFriends from '../components/NearbyFriends';\n    import Map from '../components/Map';\n\n    class IndexPage extends Component {\n      \n      /*global navigator*/\n      \n      regionFiltered = people => this.nearby.updatePeople(people)\n\n      state = { id: null, people: [],me:null }\n\n      endConnection = () => {\n        this.pusher.disconnect();\n        axios.post(`/offline/${this.state.id}`);\n      }\n\n      componentWillMount() {\n        this.pusher = new Pusher(process.env.PUSHER_APP_KEY, {\n          cluster: process.env.PUSHER_APP_CLUSTER,\n          encrypted: true\n        });\n\n        this.channel = this.pusher.subscribe('map-geofencing');\n      }\n\n      componentDidMount() {\n        \n        //get my current location\n        if ('geolocation' in navigator) {\n          navigator.geolocation.getCurrentPosition(function(position) {\n          const myLocation =   { lat: position.coords.latitude, lng: position.coords.longitude };\n          this.state.me = myLocation;   \n          console.log(myLocation);\n        });  \n       }\n        \n        \n        \n        axios.get('/people').then(({ data }) => {\n          const { people = [] } = data;\n          this.setState({ people });\n        });\n\n        window.onbeforeunload = this.endConnection;\n      }\n\n      componentWillUnmount() {\n        this.endConnection();\n      }\n      \n      \n      personaSelected = id => {\n        this.setState({ id });\n        axios.post(`/online/${id}`);\n      }\n\n      render() {\n\n        const { id, people } = this.state;\n        const person = people.find(person => person.id === id) || {};\n       \n       // const peopleOffline = people.filter(person => !person.online);\n\n       return (\n          <Layout pageTitle=\"Realtime Geofencing\">\n            <main className=\"container-fluid position-absolute h-100 bg-light\">\n              {\n                id ? <div className=\"row position-absolute w-100 h-100\">\n\n                  <section className=\"col-md-9 px-0 border-right border-gray position-relative h-100\">\n                    <Map person={person} radius={1000} people={people} channel={this.channel} onRegionFiltered={this.regionFiltered} me={this.state.me} />\n                  </section>\n\n                  <section className=\"col-md-3 position-relative d-flex flex-wrap h-100 align-items-start align-content-between bg-white px-0\">\n                    <NearbyFriends ref={elem => this.nearby = elem} person={person} />\n                  </section>\n\n                </div>\n                : <ChoosePersona count={5} people={people} onSelected={this.personaSelected} />\n              }\n            </main>\n          </Layout>\n        );\n\n      }\n\n    };\n\n    export default () => <IndexPage />"]},"metadata":{},"sourceType":"module"}