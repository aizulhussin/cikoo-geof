{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/* pages/index.js */\nimport React, { Component, Fragment } from 'react';\nimport axios from 'axios';\nimport Pusher from 'pusher-js';\nimport Layout from '../components/Layout';\nimport ChoosePersona from '../components/ChoosePersona';\nimport NearbyFriends from '../components/NearbyFriends';\nimport Map from '../components/Map';\n\nvar IndexPage = /*#__PURE__*/function (_Component) {\n  _inherits(IndexPage, _Component);\n\n  var _super = _createSuper(IndexPage);\n\n  function IndexPage() {\n    var _this;\n\n    _classCallCheck(this, IndexPage);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"regionFiltered\", function (people) {\n      return _this.nearby.updatePeople(people);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      id: null,\n      people: [],\n      me: null\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"endConnection\", function () {\n      _this.pusher.disconnect();\n\n      axios.post(\"/offline/\".concat(_this.state.id));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"personaSelected\", function (id) {\n      _this.setState({\n        id: id\n      });\n\n      axios.post(\"/online/\".concat(id));\n    });\n\n    return _this;\n  }\n\n  _createClass(IndexPage, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.pusher = new Pusher(process.env.PUSHER_APP_KEY, {\n        cluster: process.env.PUSHER_APP_CLUSTER,\n        encrypted: true\n      });\n      this.channel = this.pusher.subscribe('map-geofencing');\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      //get my current location\n      if ('geolocation' in navigator) {\n        navigator.geolocation.getCurrentPosition(function (position) {\n          this.state.me = {\n            lat: position.coords.latitude,\n            lng: position.coords.longitude\n          };\n          console.log(this.state.me);\n        });\n      }\n\n      axios.get('/people').then(function (_ref) {\n        var data = _ref.data;\n        var _data$people = data.people,\n            people = _data$people === void 0 ? [] : _data$people;\n\n        _this2.setState({\n          people: people\n        });\n      });\n      window.onbeforeunload = this.endConnection;\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.endConnection();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          id = _this$state.id,\n          people = _this$state.people;\n      var person = people.find(function (person) {\n        return person.id === id;\n      }) || {}; // const peopleOffline = people.filter(person => !person.online);\n\n      return __jsx(Layout, {\n        pageTitle: \"Realtime Geofencing\"\n      }, __jsx(\"main\", {\n        className: \"container-fluid position-absolute h-100 bg-light\"\n      }, id ? __jsx(\"div\", {\n        className: \"row position-absolute w-100 h-100\"\n      }, __jsx(\"section\", {\n        className: \"col-md-9 px-0 border-right border-gray position-relative h-100\"\n      }, __jsx(Map, {\n        person: person,\n        radius: 1000,\n        people: people,\n        channel: this.channel,\n        onRegionFiltered: this.regionFiltered,\n        me: this.state.me\n      })), __jsx(\"section\", {\n        className: \"col-md-3 position-relative d-flex flex-wrap h-100 align-items-start align-content-between bg-white px-0\"\n      }, __jsx(NearbyFriends, {\n        ref: function ref(elem) {\n          return _this3.nearby = elem;\n        },\n        person: person\n      }))) : __jsx(ChoosePersona, {\n        count: 5,\n        people: people,\n        onSelected: this.personaSelected\n      })));\n    }\n  }]);\n\n  return IndexPage;\n}(Component);\n\n;\nexport default (function () {\n  return __jsx(IndexPage, null);\n});","map":{"version":3,"sources":["/home/ubuntu/environment/cikoo-geof/pages/index.js"],"names":["React","Component","Fragment","axios","Pusher","Layout","ChoosePersona","NearbyFriends","Map","IndexPage","people","nearby","updatePeople","id","me","pusher","disconnect","post","state","setState","process","env","PUSHER_APP_KEY","cluster","PUSHER_APP_CLUSTER","encrypted","channel","subscribe","navigator","geolocation","getCurrentPosition","position","lat","coords","latitude","lng","longitude","console","log","get","then","data","window","onbeforeunload","endConnection","person","find","regionFiltered","elem","personaSelected"],"mappings":"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","sourcesContent":["/* pages/index.js */\n\n    import React, { Component, Fragment } from 'react';\n    import axios from 'axios';\n    import Pusher from 'pusher-js';\n    import Layout from '../components/Layout';\n    import ChoosePersona from '../components/ChoosePersona'\n    import NearbyFriends from '../components/NearbyFriends';\n    import Map from '../components/Map';\n\n    class IndexPage extends Component {\n      \n      /*global navigator*/\n      \n      regionFiltered = people => this.nearby.updatePeople(people)\n\n      state = { id: null, people: [],me:null }\n\n      endConnection = () => {\n        this.pusher.disconnect();\n        axios.post(`/offline/${this.state.id}`);\n      }\n\n      componentWillMount() {\n        this.pusher = new Pusher(process.env.PUSHER_APP_KEY, {\n          cluster: process.env.PUSHER_APP_CLUSTER,\n          encrypted: true\n        });\n\n        this.channel = this.pusher.subscribe('map-geofencing');\n      }\n\n      componentDidMount() {\n        \n        //get my current location\n        if ('geolocation' in navigator) {\n          navigator.geolocation.getCurrentPosition(function(position) {\n          this.state.me = { lat: position.coords.latitude, lng: position.coords.longitude }   \n          console.log(this.state.me);\n        });  \n       }\n        \n        \n        \n        axios.get('/people').then(({ data }) => {\n          const { people = [] } = data;\n          this.setState({ people });\n        });\n\n        window.onbeforeunload = this.endConnection;\n      }\n\n      componentWillUnmount() {\n        this.endConnection();\n      }\n      \n      \n      personaSelected = id => {\n        this.setState({ id });\n        axios.post(`/online/${id}`);\n      }\n\n      render() {\n\n        const { id, people } = this.state;\n        const person = people.find(person => person.id === id) || {};\n       \n       // const peopleOffline = people.filter(person => !person.online);\n\n       return (\n          <Layout pageTitle=\"Realtime Geofencing\">\n            <main className=\"container-fluid position-absolute h-100 bg-light\">\n              {\n                id ? <div className=\"row position-absolute w-100 h-100\">\n\n                  <section className=\"col-md-9 px-0 border-right border-gray position-relative h-100\">\n                    <Map person={person} radius={1000} people={people} channel={this.channel} onRegionFiltered={this.regionFiltered} me={this.state.me} />\n                  </section>\n\n                  <section className=\"col-md-3 position-relative d-flex flex-wrap h-100 align-items-start align-content-between bg-white px-0\">\n                    <NearbyFriends ref={elem => this.nearby = elem} person={person} />\n                  </section>\n\n                </div>\n                : <ChoosePersona count={5} people={people} onSelected={this.personaSelected} />\n              }\n            </main>\n          </Layout>\n        );\n\n      }\n\n    };\n\n    export default () => <IndexPage />"]},"metadata":{},"sourceType":"module"}